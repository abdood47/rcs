<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <div class="logo">
  <img src="logo.png" alt="">
</div>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --gold-primary: #D4AF37;
            --gold-light: #F4E4B0;
            --gold-dark: #B8941F;
            --royal-purple: #4A148C;
            --royal-blue: #1A237E;
        }

        .logo img {
            height: 160x; 
            width: 27vw;
            display: block;
        }

        .logo img {
            position: absolute;
            top: -15px;
            right: 80px;
        }
        
        [dir="rtl"] { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .dark {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e2e8f0;
        }
        
        .dark .card {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .dark input, .dark textarea, .dark select {
            background-color: #374151;
            color: #e2e8f0;
            border-color: var(--gold-dark);
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.15);
            margin-bottom: 20px;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            color: #1a1a2e;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }
        
        .btn-edit:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.5);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
        }
        
        .btn-delete:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.5);
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gold-light);
            border-radius: 12px;
            margin-top: 8px;
            transition: all 0.3s;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        .label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
            display: block;
        }
        
        .dark .label {
            color: var(--gold-light);
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 2px solid #f59e0b;
        }
        
        .status-inprogress {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 2px solid #3b82f6;
        }
        
        .status-resolved {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .status-closed {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #374151;
            border: 2px solid #9ca3af;
        }
        
        .tab {
            cursor: pointer;
            padding: 14px 28px;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            color: #6b7280;
        }
        
        .tab:hover {
            color: var(--gold-dark);
            background: rgba(212, 175, 55, 0.05);
        }
        
        .tab.active {
            border-bottom-color: var(--gold-primary);
            color: var(--gold-dark);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .hidden {
            display: none !important;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            color: white;
            font-weight: 600;
            min-width: 300px;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .notification.info {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            color: #1a1a2e;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .header-gradient {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, var(--gold-dark) 100%);
        }
        
        .stat-card {
            border-radius: 16px;
            padding: 24px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }
        
        thead th {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            color: #1a1a2e;
            font-weight: 700;
            padding: 14px;
            text-align: right;
            border: none;
        }
        
        thead th:first-child {
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        
        thead th:last-child {
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }
        
        tbody tr {
            background: white;
            transition: all 0.3s;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .dark tbody tr {
            background: #1f2937;
        }
        
        tbody tr:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.2);
        }
        
        tbody td {
            padding: 14px;
            border: none;
        }
        
        tbody tr td:first-child {
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        
        tbody tr td:last-child {
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            padding: 6px;
            transition: transform 0.2s;
            border-radius: 8px;
        }
        
        .action-btn:hover {
            transform: scale(1.2);
            background: rgba(212, 175, 55, 0.1);
        }

        .edit-mode-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 3px solid var(--gold-primary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            50% { box-shadow: 0 0 20px 10px rgba(212, 175, 55, 0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="header-gradient text-white py-6 shadow-2xl">
        <div class="container mx-auto px-4 flex justify-between items-center flex-wrap gap-4">
            <div class="flex items-center gap-4">
                <div>
                    <p class="text-sm mt-1" id="headerSubtitle" style="color: var(--gold-light);">
                        <span id="userRoleDisplay"></span>
                    </p>
                </div>
            </div>
            
            <div class="flex gap-3 items-center flex-wrap">
                <button onclick="toggleDarkMode()" class="btn-secondary">
                    ğŸŒ“ <span id="darkModeText">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù…</span>
                </button>
                <button onclick="showChangePassword()" class="btn-secondary" id="changePassBtn" style="display: none;">
                    ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                </button>
                <button onclick="showSettings()" class="btn-secondary" id="settingsBtn" style="display: none;">
                    âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
                <button onclick="logout()" class="btn-primary" id="logoutBtn" style="display: none;">
                    ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Login Section -->
        <div id="loginSection">
            <div class="card max-w-md mx-auto">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold" style="color: var(--gold-dark);">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                    <p class="text-sm text-gray-600 mt-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</p>
                </div>
                
                <div class="mb-4">
                    <label class="label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="loginUsername" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>
                <div class="mb-4">
                    <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="loginPassword" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <div class="mb-6">
                    <label class="label">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                    <select id="loginRole" class="input-field">
                        <option value="employee">ğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…ÙˆØ¸Ù</option>
                        <option value="reviewer">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</option>
                        <option value="admin"> Ø§Ù„Ù…Ø¯ÙŠØ± (Admin)</option>
                    </select>
                </div>
                <button onclick="login()" class="btn-primary w-full">
                    ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </div>
        </div>

        <!-- Change Password Modal -->
        <div id="changePasswordModal" class="hidden">
            <div class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full shadow-2xl" style="border: 3px solid var(--gold-primary);">
                    <h2 class="text-2xl font-bold mb-6" style="color: var(--gold-dark);">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
                    
                    <div class="mb-4">
                        <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                        <input type="password" id="currentPassword" class="input-field">
                    </div>
                    <div class="mb-4">
                        <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="newPassword" class="input-field">
                    </div>
                    <div class="mb-6">
                        <label class="label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="confirmPassword" class="input-field">
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="saveNewPassword()" class="btn-primary flex-1">ğŸ’¾ Ø­ÙØ¸</button>
                        <button onclick="hideChangePassword()" class="btn-secondary flex-1">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section (Admin Only) -->
        <div id="settingsSection" class="hidden">
            <div class="card max-w-4xl mx-auto">
                <div class="flex items-center gap-3 mb-6">
                    <svg class="w-8 h-8" fill="var(--gold-primary)" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                    </svg>
                    <h2 class="text-2xl font-bold" style="color: var(--gold-dark);">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)</h2>
                </div>
                
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px dashed var(--gold-primary); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">ğŸ”— Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†:</h3>
                    <select id="storageMethod" class="input-field mb-4" onchange="updateStorageConfig()">
                        <option value="local">Local Storage</option>
                        <option value="powerautomate">Power Automate</option>
                        <option value="api">Python API</option>
                        <option value="graphapi">Microsoft Graph API</option>
                    </select>
                </div>

                <!-- Power Automate Config -->
                <div id="powerAutomateConfig" class="hidden mb-6">
                    <h4 class="font-bold mb-2">ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Power Automate</h4>
                    <label class="label">Ø±Ø§Ø¨Ø· Flow URL:</label>
                    <input type="text" id="flowUrl" class="input-field" placeholder="https://prod-xx.westus.logic.azure.com:443/workflows/...">
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">ğŸ“ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·: Power Automate â†’ Flow â†’ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ HTTP â†’ Ø§Ù†Ø³Ø® HTTP POST URL</p>
                </div>

                <!-- API Config -->
                <div id="apiConfig" class="hidden mb-6">
                    <h4 class="font-bold mb-2">ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Python API</h4>
                    <label class="label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±:</label>
                    <input type="text" id="apiUrl" class="input-field" placeholder="http://192.168.1.100:5000" value="http://localhost:5000">
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">ğŸ“ Ù…Ø«Ø§Ù„: http://192.168.1.100:5000 (Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù€ IP Ø§Ù„Ø³ÙŠØ±ÙØ±)</p>
                    <button onclick="testApiConnection()" class="btn-primary mt-3">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
                </div>

                <!-- Graph API Config -->
                <div id="graphApiConfig" class="hidden mb-6">
                    <h4 class="font-bold mb-2">ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Microsoft Graph API</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="label">Tenant ID:</label>
                            <input type="text" id="tenantId" class="input-field" placeholder="xxxxxxxx-xxxx-xxxx-xxxx">
                        </div>
                        <div>
                            <label class="label">Client ID:</label>
                            <input type="text" id="clientId" class="input-field" placeholder="xxxxxxxx-xxxx-xxxx-xxxx">
                        </div>
                        <div>
                            <label class="label">Client Secret:</label>
                            <input type="password" id="clientSecret" class="input-field">
                        </div>
                        <div>
                            <label class="label">Drive ID:</label>
                            <input type="text" id="driveId" class="input-field">
                        </div>
                        <div class="md:col-span-2">
                            <label class="label">File ID:</label>
                            <input type="text" id="fileId" class="input-field">
                        </div>
                    </div>
                </div>

                <div class="flex gap-4">
                    <button onclick="saveSettings()" class="btn-primary flex-1">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                    <button onclick="hideSettings()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>

        <!-- Main Section -->
        <div id="mainSection" class="hidden">
            <!-- Main Navigation -->
            <div class="card">
                <div class="flex border-b-2 overflow-x-auto" style="border-color: var(--gold-light);">
                    <div class="tab active" onclick="showTab('new')" id="tabNew">â• ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©</div>
                    <div class="tab" onclick="showTab('view')" id="tabView">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</div>
                    <div class="tab" onclick="showTab('dashboard')" id="tabDashboard">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                    <div class="tab" onclick="showTab('reports')" id="tabReports">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
                </div>
            </div>

            <!-- Complaint Form Section -->
            <div id="complaintFormSection" class="hidden">
                <div class="card">
                    <!-- Edit Mode Banner -->
                    <div id="editModeBanner" class="hidden edit-mode-banner">
                        <h3 class="text-2xl font-bold" style="color: var(--gold-dark);">
                            âœï¸ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                        </h3>
                        <p class="text-lg mt-2" style="color: #92400e;">
                            Ø¬Ø§Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ Ø±Ù‚Ù…: <strong id="editingComplaintId"></strong>
                        </p>
                    </div>

                    <h2 class="text-2xl font-bold mb-6" id="formTitle" style="color: var(--gold-dark);">
                        â• ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©
                    </h2>
                    
                    <h3 class="text-xl font-semibold mb-4" style="color: var(--gold-primary);">
                        ğŸ‘¨â€ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
                    </h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨ *</label>
                            <input type="text" id="studentName" class="input-field" required>
                        </div>
                        <div>
                            <label class="label">Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ (Student ID) *</label>
                            <input type="text" id="studentId" class="input-field" required>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ù†Ø¸Ø§Ù…/Ø§Ù„Ù…Ù†Ù‡Ø¬ *</label>
                            <select id="curriculum" class="input-field">
                                <option value="IG">IG - International General</option>
                                <option value="British">British</option>
                                <option value="American">American</option>
                                <option value="National">National</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„ØµÙ (Grade) *</label>
                            <select id="grade" class="input-field">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                <option value="1">Grade 1</option>
                                <option value="2">Grade 2</option>
                                <option value="3">Grade 3</option>
                                <option value="4">Grade 4</option>
                                <option value="5">Grade 5</option>
                                <option value="6">Grade 6</option>
                                <option value="7">Grade 7</option>
                                <option value="8">Grade 8</option>
                                <option value="9">Grade 9</option>
                                <option value="10">Grade 10</option>
                                <option value="11">Grade 11</option>
                                <option value="12">Grade 12</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„ÙØµÙ„ (Section)</label>
                            <input type="text" id="section" class="input-field" placeholder="A, B, C...">
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold mb-4" style="color: var(--gold-primary);">
                        ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
                    </h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="label">Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± *</label>
                            <input type="text" id="guardianName" class="input-field" required>
                        </div>
                        <div>
                            <label class="label">ØµÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¨Ø© *</label>
                            <select id="relation" class="input-field">
                                <option value="Father">Father - Ø£Ø¨</option>
                                <option value="Mother">Mother - Ø£Ù…</option>
                                <option value="Guardian">Guardian - ÙˆÙ„ÙŠ Ø£Ù…Ø±</option>
                                <option value="Other">Other - Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                            <input type="tel" id="phone" class="input-field" placeholder="+20XXXXXXXXXX" required>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" id="email" class="input-field" placeholder="optional@example.com">
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold mb-4" style="color: var(--gold-primary);">
                        ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰
                    </h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
                            <select id="complaintType" class="input-field">
                                <option value="Behavior">Behavior - Ø³Ù„ÙˆÙƒÙŠ</option>
                                <option value="Academic">Academic - Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option>
                                <option value="Health">Health - ØµØ­ÙŠ</option>
                                <option value="General">General - Ø¹Ø§Ù…</option>
                                <option value="Technology">Technology - ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
                                <option value="Other">Other - Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                            <select id="department" class="input-field">
                                <option value="Student Affairs">Student Affairs - Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                                <option value="IT">IT - ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                                <option value="Discipline">Discipline - Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·</option>
                                <option value="Academic Dept">Academic Dept - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <select id="status" class="input-field">
                                <option value="Pending">â³ Pending - Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                                <option value="In Progress">ğŸ”„ In Progress - Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                                <option value="Resolved">âœ… Resolved - ØªÙ… Ø§Ù„Ø­Ù„</option>
                                <option value="Closed">ğŸ”’ Closed - Ù…ØºÙ„Ù‚</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-6">
                        <label class="label">ÙˆØµÙ Ù…ÙØµÙ„ Ù„Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
                        <textarea id="description" class="input-field" rows="5" required></textarea>
                    </div>
                    <div class="mb-6">
                        <label class="label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</label>
                        <textarea id="adminNotes" class="input-field" rows="3"></textarea>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="submitComplaint()" class="btn-primary flex-1" id="submitBtn">
                            <span id="submitBtnText">âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰</span>
                        </button>
                        <button onclick="cancelEdit()" class="btn-secondary flex-1" id="cancelBtn" style="display: none;">
                            âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                        </button>
                    </div>
                </div>
            </div>

            <!-- View Complaints Section -->
            <div id="viewComplaintsSection" class="hidden">
                <div class="card">
                    <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                        <h2 class="text-2xl font-bold" style="color: var(--gold-dark);">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</h2>
                    </div>
                    
                    <div class="grid md:grid-cols-4 gap-4 mb-6">
                        <input type="text" id="searchFilter" placeholder="ğŸ” Ø¨Ø­Ø«..." class="input-field" oninput="filterComplaints()">
                        <select id="statusFilter" class="input-field" onchange="filterComplaints()">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="Pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="In Progress">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                            <option value="Resolved">ØªÙ… Ø§Ù„Ø­Ù„</option>
                            <option value="Closed">Ù…ØºÙ„Ù‚</option>
                        </select>
                        <select id="typeFilter" class="input-field" onchange="filterComplaints()">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                            <option value="Behavior">Ø³Ù„ÙˆÙƒÙŠ</option>
                            <option value="Academic">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option>
                            <option value="Health">ØµØ­ÙŠ</option>
                            <option value="General">Ø¹Ø§Ù…</option>
                            <option value="Technology">ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
                            <option value="Other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                        <button onclick="exportToExcel()" class="btn-primary">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
                    </div>

                    <div id="complaintsTable"></div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboardSection" class="hidden">
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                        <h3 class="text-lg font-semibold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</h3>
                        <p class="text-5xl font-bold mt-3" id="totalCount">0</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <h3 class="text-lg font-semibold">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>
                        <p class="text-5xl font-bold mt-3" id="pendingCount">0</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <h3 class="text-lg font-semibold">ØªÙ… Ø§Ù„Ø­Ù„</h3>
                        <p class="text-5xl font-bold mt-3" id="resolvedCount">0</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);">
                        <h3 class="text-lg font-semibold">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø­Ù„</h3>
                        <p class="text-5xl font-bold mt-3" id="avgTime">-</p>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h3>
                        <canvas id="typeChart"></canvas>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©</h3>
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsSection" class="hidden">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-6" style="color: var(--gold-dark);">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
                    <div class="grid md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="fromDate" class="input-field">
                        </div>
                        <div>
                            <label class="label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="toDate" class="input-field">
                        </div>
                        <div class="flex items-end">
                            <button onclick="generateReport()" class="btn-primary w-full">ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±</button>
                        </div>
                    </div>
                    <div id="reportOutput"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let complaints = [];
        let currentUser = null;
        let isDark = false;
        let isEditMode = false;
        let editingComplaintId = null;
        let config = {
            storageMethod: 'local',
            flowUrl: '',
            apiUrl: 'http://localhost:5000',
            tenantId: '',
            clientId: '',
            clientSecret: '',
            driveId: '',
            fileId: ''
        };

        let users = {
            employee: { username: 'user', password: '1234', role: 'employee', roleName: 'Ø§Ù„Ù…ÙˆØ¸Ù' },
            reviewer: { username: 'user', password: '12345', role: 'reviewer', roleName: 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„' },
            admin: { username: 'admin', password: 'admin123', role: 'admin', roleName: 'Ø§Ù„Ù…Ø¯ÙŠØ±' }
        };

        function loadData() {
            const saved = localStorage.getItem('complaints');
            if (saved) complaints = JSON.parse(saved);
            
            const savedUsers = localStorage.getItem('systemUsers');
            if (savedUsers) users = JSON.parse(savedUsers);
            
            const savedConfig = localStorage.getItem('systemConfig');
            if (savedConfig) config = { ...config, ...JSON.parse(savedConfig) };
        }

        function saveData() {
            localStorage.setItem('complaints', JSON.stringify(complaints));
        }

        function saveUsers() {
            localStorage.setItem('systemUsers', JSON.stringify(users));
        }

        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainSection();
            } else {
                showLoginSection();
            }
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;

            if (!username || !password) {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }

            if (users[role] && users[role].username === username && users[role].password === password) {
                currentUser = {
                    username: username,
                    role: role,
                    roleName: users[role].roleName,
                    loginTime: new Date().toISOString()
                };

                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainSection();
                showNotification(`âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ ${users[role].roleName}!`, 'success');
            } else {
                showNotification('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            }
        }

        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                localStorage.removeItem('currentUser');
                currentUser = null;
                location.reload();
            }
        }

        function showLoginSection() {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('mainSection').classList.add('hidden');
        }

        function showMainSection() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
            
            document.getElementById('userRoleDisplay').textContent = `${currentUser.roleName} - ${currentUser.username}`;
            document.getElementById('logoutBtn').style.display = 'block';
            document.getElementById('changePassBtn').style.display = 'block';
            
            if (currentUser.role === 'admin') {
                document.getElementById('settingsBtn').style.display = 'block';
            }

            showTab('new');
        }

        function showChangePassword() {
            document.getElementById('changePasswordModal').classList.remove('hidden');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function hideChangePassword() {
            document.getElementById('changePasswordModal').classList.add('hidden');
        }

        function saveNewPassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (!current || !newPass || !confirm) {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }

            if (users[currentUser.role].password !== current) {
                showNotification('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }

            if (newPass !== confirm) {
                showNotification('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©', 'error');
                return;
            }

            if (newPass.length < 6) {
                showNotification('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }

            users[currentUser.role].password = newPass;
            saveUsers();
            hideChangePassword();
            showNotification('âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function toggleDarkMode() {
            isDark = !isDark;
            document.body.classList.toggle('dark', isDark);
        }

        function showSettings() {
            if (currentUser.role !== 'admin') {
                showNotification('âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
                return;
            }
            document.getElementById('settingsSection').classList.remove('hidden');
            document.getElementById('mainSection').classList.add('hidden');
            document.getElementById('storageMethod').value = config.storageMethod;
            updateStorageConfig();
        }

        function updateStorageConfig() {
            const method = document.getElementById('storageMethod').value;
            document.getElementById('powerAutomateConfig').classList.add('hidden');
            document.getElementById('apiConfig').classList.add('hidden');
            document.getElementById('graphApiConfig').classList.add('hidden');

            if (method === 'powerautomate') {
                document.getElementById('powerAutomateConfig').classList.remove('hidden');
                document.getElementById('flowUrl').value = config.flowUrl;
            } else if (method === 'api') {
                document.getElementById('apiConfig').classList.remove('hidden');
                document.getElementById('apiUrl').value = config.apiUrl;
            } else if (method === 'graphapi') {
                document.getElementById('graphApiConfig').classList.remove('hidden');
                document.getElementById('tenantId').value = config.tenantId;
                document.getElementById('clientId').value = config.clientId;
                document.getElementById('clientSecret').value = config.clientSecret;
                document.getElementById('driveId').value = config.driveId;
                document.getElementById('fileId').value = config.fileId;
            }
        }

        function saveSettings() {
            config.storageMethod = document.getElementById('storageMethod').value;
            
            if (config.storageMethod === 'powerautomate') {
                config.flowUrl = document.getElementById('flowUrl').value;
            } else if (config.storageMethod === 'api') {
                config.apiUrl = document.getElementById('apiUrl').value;
            } else if (config.storageMethod === 'graphapi') {
                config.tenantId = document.getElementById('tenantId').value;
                config.clientId = document.getElementById('clientId').value;
                config.clientSecret = document.getElementById('clientSecret').value;
                config.driveId = document.getElementById('driveId').value;
                config.fileId = document.getElementById('fileId').value;
            }

            localStorage.setItem('systemConfig', JSON.stringify(config));
            showNotification('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            hideSettings();
        }

        async function testApiConnection() {
            const apiUrl = document.getElementById('apiUrl').value;
            try {
                const response = await fetch(`${apiUrl}/api/complaints`);
                if (response.ok) {
                    showNotification('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­!', 'success');
                } else {
                    showNotification('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
                }
            } catch (error) {
                showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message, 'error');
            }
        }

        function hideSettings() {
            document.getElementById('settingsSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
        }

        function showTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            
            document.getElementById('complaintFormSection').classList.add('hidden');
            document.getElementById('viewComplaintsSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('reportsSection').classList.add('hidden');

            switch(tab) {
                case 'new':
                    document.querySelector('[onclick="showTab(\'new\')"]').classList.add('active');
                    document.getElementById('complaintFormSection').classList.remove('hidden');
                    if (!isEditMode) clearForm();
                    break;
                case 'view':
                    document.querySelector('[onclick="showTab(\'view\')"]').classList.add('active');
                    document.getElementById('viewComplaintsSection').classList.remove('hidden');
                    renderComplaints();
                    break;
                case 'dashboard':
                    document.querySelector('[onclick="showTab(\'dashboard\')"]').classList.add('active');
                    document.getElementById('dashboardSection').classList.remove('hidden');
                    renderDashboard();
                    break;
                case 'reports':
                    document.querySelector('[onclick="showTab(\'reports\')"]').classList.add('active');
                    document.getElementById('reportsSection').classList.remove('hidden');
                    break;
            }
        }

        function clearForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('studentId').value = '';
            document.getElementById('curriculum').selectedIndex = 0;
            document.getElementById('grade').selectedIndex = 0;
            document.getElementById('section').value = '';
            document.getElementById('guardianName').value = '';
            document.getElementById('relation').selectedIndex = 0;
            document.getElementById('phone').value = '';
            document.getElementById('email').value = '';
            document.getElementById('complaintType').selectedIndex = 0;
            document.getElementById('department').selectedIndex = 0;
            document.getElementById('status').selectedIndex = 0;
            document.getElementById('description').value = '';
            document.getElementById('adminNotes').value = '';
            
            isEditMode = false;
            editingComplaintId = null;
            document.getElementById('formTitle').innerHTML = 'â• ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©';
            document.getElementById('submitBtnText').textContent = 'âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰';
            document.getElementById('editModeBanner').classList.add('hidden');
            document.getElementById('cancelBtn').style.display = 'none';
        }

        function editComplaint(id) {
            const complaint = complaints.find(c => c.id === id);
            if (!complaint) return;

            document.getElementById('studentName').value = complaint.studentName;
            document.getElementById('studentId').value = complaint.studentId;
            document.getElementById('curriculum').value = complaint.curriculum;
            document.getElementById('grade').value = complaint.grade;
            document.getElementById('section').value = complaint.section || '';
            document.getElementById('guardianName').value = complaint.guardianName;
            document.getElementById('relation').value = complaint.relation;
            document.getElementById('phone').value = complaint.phone;
            document.getElementById('email').value = complaint.email || '';
            document.getElementById('complaintType').value = complaint.type;
            document.getElementById('department').value = complaint.department;
            document.getElementById('status').value = complaint.status;
            document.getElementById('description').value = complaint.description;
            document.getElementById('adminNotes').value = complaint.adminNotes || '';

            isEditMode = true;
            editingComplaintId = id;
            document.getElementById('formTitle').innerHTML = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰';
            document.getElementById('submitBtnText').textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
            document.getElementById('editModeBanner').classList.remove('hidden');
            document.getElementById('editingComplaintId').textContent = id;
            document.getElementById('cancelBtn').style.display = 'block';

            showTab('new');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showNotification(`âœï¸ Ø¬Ø§Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ ${id}`, 'info');
        }

        function cancelEdit() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŸ')) {
                clearForm();
                showTab('view');
            }
        }

        function submitComplaint() {
            const complaintData = {
                studentName: document.getElementById('studentName').value,
                studentId: document.getElementById('studentId').value,
                curriculum: document.getElementById('curriculum').value,
                grade: document.getElementById('grade').value,
                section: document.getElementById('section').value,
                guardianName: document.getElementById('guardianName').value,
                relation: document.getElementById('relation').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                type: document.getElementById('complaintType').value,
                department: document.getElementById('department').value,
                status: document.getElementById('status').value,
                description: document.getElementById('description').value,
                adminNotes: document.getElementById('adminNotes').value
            };

            if (!complaintData.studentName || !complaintData.studentId || !complaintData.guardianName || 
                !complaintData.phone || !complaintData.description || !complaintData.grade) {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }

            if (isEditMode && editingComplaintId) {
                // ØªØ¹Ø¯ÙŠÙ„ Ø´ÙƒÙˆÙ‰ Ù…ÙˆØ¬ÙˆØ¯Ø©
                const index = complaints.findIndex(c => c.id === editingComplaintId);
                if (index !== -1) {
                    // Ù†Ø­ØªÙØ¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
                    const oldComplaint = complaints[index];
                    
                    // Ù†Ø­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
                    complaints[index] = {
                        ...oldComplaint,  // Ù†Ø­ØªÙØ¸ Ø¨ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                        ...complaintData, // Ù†Ø­Ø¯Ø« Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                        id: oldComplaint.id, // Ù†ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù€ ID Ù…Ø§ ÙŠØªØºÙŠØ±Ø´
                        createdBy: oldComplaint.createdBy, // Ù†Ø­ØªÙØ¸ Ø¨Ù…Ù† Ø£Ù†Ø´Ø£ Ø§Ù„Ø´ÙƒÙˆÙ‰
                        createdByRole: oldComplaint.createdByRole,
                        createdAt: oldComplaint.createdAt, // Ù†Ø­ØªÙØ¸ Ø¨ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
                        updatedAt: new Date().toISOString(), // Ù†Ø­Ø¯Ø« ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙ‚Ø·
                        activityLog: [
                            ...oldComplaint.activityLog, // Ù†Ø­ØªÙØ¸ Ø¨Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ…
                            {
                                action: 'Updated',
                                user: currentUser.username,
                                role: currentUser.roleName,
                                timestamp: new Date().toISOString(),
                                changes: 'ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙƒÙˆÙ‰'
                            }
                        ]
                    };

                    saveData();
                    showNotification(`âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ ${editingComplaintId} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    clearForm();
                    setTimeout(() => showTab('view'), 1500);
                } else {
                    showNotification('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙˆÙ‰', 'error');
                }
            } else {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©
                const complaint = {
                    id: `2025-${String(complaints.length + 1).padStart(4, '0')}`,
                    ...complaintData,
                    createdBy: currentUser.username,
                    createdByRole: currentUser.roleName,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    activityLog: [{
                        action: 'Created',
                        user: currentUser.username,
                        role: currentUser.roleName,
                        timestamp: new Date().toISOString()
                    }]
                };

                complaints.push(complaint);
                saveData();
                showNotification(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰! Ø±Ù‚Ù…: ${complaint.id}`, 'success');
                clearForm();
                setTimeout(() => showTab('view'), 1500);
            }
        }

        function renderComplaints() {
            const filtered = filterComplaintsData();

            let html = '<div class="overflow-x-auto"><table><thead><tr>';
            html += '<th>Ø±Ù‚Ù… Ø§Ù„Ø´ÙƒÙˆÙ‰</th><th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th style="min-width: 250px;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>';
            html += '</tr></thead><tbody>';

            if (filtered.length === 0) {
                html += '<tr><td colspan="7" class="text-center p-8" style="color: var(--gold-dark);">ğŸ“‹ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰</td></tr>';
            }

            filtered.forEach(c => {
                const statusClass = `status-${c.status.toLowerCase().replace(' ', '')}`;
                html += `<tr>`;
                html += `<td class="font-bold" style="color: var(--gold-dark);">${c.id}</td>`;
                html += `<td><strong>${c.studentName}</strong></td>`;
                html += `<td>${c.type}</td>`;
                html += `<td><span class="status-badge ${statusClass}">${c.status}</span></td>`;
                html += `<td>${c.department}</td>`;
                html += `<td>${new Date(c.createdAt).toLocaleDateString('ar-EG')}</td>`;
                html += `<td><div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">`;
                
                html += `<button onclick="viewComplaint('${c.id}')" class="action-btn" title="Ø¹Ø±Ø¶" style="font-size: 24px;">ğŸ‘ï¸</button>`;
                
                if (currentUser.role === 'employee' || currentUser.role === 'reviewer' || currentUser.role === 'admin') {
                    html += `<button onclick="editComplaint('${c.id}')" class="btn-edit"><span style="font-size: 18px;">âœï¸</span><span>ØªØ¹Ø¯ÙŠÙ„</span></button>`;
                }
                
                if (currentUser.role === 'admin') {
                    html += `<button onclick="deleteComplaint('${c.id}')" class="btn-delete"><span style="font-size: 18px;">ğŸ—‘ï¸</span><span>Ø­Ø°Ù</span></button>`;
                }
                
                html += `</div></td></tr>`;
            });

            html += '</tbody></table></div>';
            document.getElementById('complaintsTable').innerHTML = html;
        }

        function filterComplaintsData() {
            const search = document.getElementById('searchFilter')?.value.toLowerCase() || '';
            const status = document.getElementById('statusFilter')?.value || '';
            const type = document.getElementById('typeFilter')?.value || '';

            return complaints.filter(c => {
                const matchSearch = !search || c.studentName.toLowerCase().includes(search) || c.id.toLowerCase().includes(search);
                const matchStatus = !status || c.status === status;
                const matchType = !type || c.type === type;
                return matchSearch && matchStatus && matchType;
            });
        }

        function filterComplaints() {
            renderComplaints();
        }

        function viewComplaint(id) {
            const c = complaints.find(x => x.id === id);
            if (!c) return;

            let html = `<div class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4" onclick="this.remove()">
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl" onclick="event.stopPropagation()" style="border: 3px solid var(--gold-primary);">
                    <div class="flex justify-between items-start mb-6">
                        <h2 class="text-3xl font-bold" style="color: var(--gold-dark);">ğŸ“‹ ${c.id}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-4xl hover:text-red-600" style="color: var(--gold-primary);">&times;</button>
                    </div>
                    <div class="mb-4"><h3 class="text-xl font-bold mb-3" style="color: var(--gold-primary);">ğŸ‘¨â€ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                    <div class="grid md:grid-cols-2 gap-3">
                        <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${c.studentName}</div>
                        <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> ${c.studentId}</div>
                        <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ù…Ù†Ù‡Ø¬:</strong> ${c.curriculum}</div>
                        <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„ØµÙ:</strong> Grade ${c.grade}</div>
                    </div></div>
                    <div class="mb-4"><h3 class="text-xl font-bold mb-3" style="color: var(--gold-primary);">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</h3>
                    <div class="grid md:grid-cols-2 gap-3">
                        <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${c.guardianName}</div>
                        <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${c.phone}</div>
                    </div></div>
                    <div class="mb-4"><p class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„ÙˆØµÙ:</strong> ${c.description}</p></div>
                </div>
            </div>`;
            document.body.insertAdjacentHTML('beforeend', html);
        }

        function deleteComplaint(id) {
            if (currentUser.role !== 'admin') {
                showNotification('âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©', 'error');
                return;
            }
            if (!confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø´ÙƒÙˆÙ‰ØŸ')) return;
            complaints = complaints.filter(c => c.id !== id);
            saveData();
            renderComplaints();
            showNotification('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
        }

        function renderDashboard() {
            document.getElementById('totalCount').textContent = complaints.length;
            document.getElementById('pendingCount').textContent = complaints.filter(c => c.status === 'Pending').length;
            document.getElementById('resolvedCount').textContent = complaints.filter(c => c.status === 'Resolved').length;
        }

        function generateReport() {
            showNotification('ğŸ“Š Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...', 'info');
        }

        function exportToExcel() {
            let csv = '\ufeffID,Student,Grade,Type,Status,Date\n';
            complaints.forEach(c => {
                csv += `"${c.id}","${c.studentName}","${c.grade}","${c.type}","${c.status}","${c.createdAt}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Complaints_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            showNotification('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'success');
        }

        function showNotification(message, type = 'success') {
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        loadData();
        checkAuth();
    </script>
</body>
</html>